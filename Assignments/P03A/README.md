# P03 - Missile Command (Part 1) - Practice Spatial Data Creation and Intersection.
## Caleb Sneath
#### September 28, 2022
### Description:

# Description: 
A collection of database backups, query commands, and screenshots to show the results of loading spatial data from files, randomly generating spatial data, detecting and predicting collisions, and visualizing that data. This project is designed as the first part of a multi-part project with the goal of creating something similar to the 80's arcade game, "Missile Command". This part of the project specifically focuses on reading and generating the data for missile paths as well as military bases.

### Files

|   #   | File            | Description                                        |
| :---: | --------------- | -------------------------------------------------- |
|   1   | [us_mil.sql](https://github.com/CalebSneath/5443-Spatial-DB-Sneath/tree/main/Assignments/P03A/us_mil.sql)         | Contains a backup of the military bases table.   |
|   2   | [Projectile Creation Commands.sql](https://github.com/CalebSneath/5443-Spatial-DB-Sneath/tree/main/Assignments/P03A/Projectile%20Creation%20Commands.sql)         | Contains the commands to generate the random missile paths and timestamps. |
|   3   | [Various .jpeg files]  | Screenshots to show end data visualization.  |

### Instructions

- Load up PGAdmin or your preferred database management software.
- Create or load a database. This database was named "P03A".
- Run the SQL commands on any of the .SQL files to copy the resulting database.
- To generate a table for the bounding box, load up OSGeo4W Shell, and run the appropriate commented out ogr command from the "Projectile Creation Commands.sql" file, modifying any parameters as appropriate such as login credentials.
- Load up QGIS. Go to Layer -> Add Layer -> Add PostGIS Layer. 
- Connect to your database and load any layer you wish to visualize.

### Overview
In order for a reasonable simulation to be run, bases need to be modeled, and flight paths for the missiles need to be generated. The military bases were loaded from a real world shapefile of US military bases, although this data may be modified or discarded at a later time to make the simulation more interesting or "fair". 
<br>
<img src="Box With Bases.jpeg" width="720">
<br>
The flight paths were generated by first creating a bounding box that encompasses the entirety of the mainland US, with a little buffer area around it. Then, an angle is randomly computed from 0 to 2 pi radians and a line larger than the bounding box is generated stretching out from the center of the bounding box. The intersection of the bounding box and this line is the starting random point. Next, it is important to ensure that an ending point is generated along the bounding box, and to ensure that the trajectory is reasonably over the US. Basically, it is desirable to avoid a missile starting and exiting in the same corner of the bounding box while only flying over the ocean. To do this, the angle of the starting point is recomputed relative to the center of the bounding box. Next, a random angle is generated on the other end of the center of the bounding box to ensure that it will not perfectly pass through the center, but it should still pass within an arc through the main landmass of the US. This angle then follows a similar process used to generate the starting point. Now that the starting and end points are created, they can be used to create a linestring and then multiline for the trajectory in a new column, with the path interpolated. A spatial index can also be added to this geometry.
<br>
<img src="Trajectories.jpeg" width="720">
<br>
With this, everything is set to generate timestamps. Aside from their relative position to each other, the starting times are rather meaningless. A random value is generated and multiplied times the endpoint of the desired range to get the starting point. Next, the distance between start and endpoints is computed. This length is then divided by missile speed to find the time it takes a missile to cross its path. While this speed can be precisely given later, for now it was simply randomly generated from what may be considered a reasonable range of 0.5 to 1.5 times the speed of sound. This time to cross is then added to the starting time to determine ending times for the trajectory, and the now redundant start and end point columns are dropped from the table.
<br>
<img src="Intersections.jpeg" width="720">
<br>
A query is run to select the pairs where the ST_Intersects function in a query returns true, and plugged into the ST_Interception function, with several conversions back and forth between geometry and geography along the way. 

### Future Possibilities
Going forward, the concept can be "gamified" a bit more for an interesting learning experience. The bases could have several health systems. There are several possible ways to model this, from a macabre "population" statistic, to response radius, all the way to a more unified and simplistic count for how many anti-air missiles the bases have. I think overall the flight path generation process here generates fairly desirable results, although it can still be improved further with some model of altitude in a Z coordinate. The simplest way to do this would be to randomly assign a starting altitude and upper height altitude. If the projectiles should go all the way across, then the center of the line can be given the upper height. From there, it is a parabolic equation and the intermediate points can be solved as one.

# Credits
### Example data obtained from: 
### https://github.com/rugbyprof/5443-Spatial-DB/tree/main/Assignments/P02
### https://github.com/rugbyprof/5443-Spatial-DB/tree/main/Assignments/P03
<br>

### Code Inspiration:
The intersection query was partially inspired by an answer on this question:
### https://gis.stackexchange.com/questions/271824/st-intersection-intersection-of-all-geometries-in-a-table
